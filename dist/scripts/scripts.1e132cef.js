"use strict";$(document).ready(function(){langSwitch.initLang(),langSwitch.buttonClicked(),schoolInput.typeAhead(),schoolInput.formSubmit(),helpContact.showHideDropdown(),userAuth.loginButtonClicked(),userAuth.registerButtonClicked(),userAuth.loginFormSubmit(),userAuth.registerFormSubmit(),userAuth.profileFormSubmit()});var langSwitch={toEn:function(){$(".zh").addClass("hidden"),$(".en").removeClass("hidden"),$(".en").removeClass("invisible"),$("title").text("Apartment Hunting"),$("#search-str").attr("placeholder","I will go to..."),schoolInput.init("unable to find any schools matching current query")},toZh:function(){$(".en").addClass("hidden"),$(".zh").removeClass("hidden"),$(".zh").removeClass("invisible"),$("title").text("美国留学租房"),$("#search-str").attr("placeholder","输入学校查找附近住房"),schoolInput.init("无法找到匹配的学校")},initLang:function(){var a=localStorage.getItem("userLang");a||(a=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage),"en-US"===a||"en"===a?(localStorage.setItem("userLang","en"),this.toEn()):(localStorage.setItem("userLang","zh"),this.toZh())},buttonClicked:function(){$("#switch-zh").click(function(a){a.preventDefault(),localStorage.setItem("userLang","zh"),langSwitch.toZh()}),$("#switch-en").click(function(a){a.preventDefault(),localStorage.setItem("userLang","en"),langSwitch.toEn()})}},helpContact={showHideDropdown:function(){var a=$(".help-dropdown");$(".help-contact").mouseenter(function(){a.css("display","block")}).mouseleave(function(){a.css("display","none")}).click(function(){a.toggle()})}},substringMatcher=function(a){return function(b,c){var d,e;d=[],e=new RegExp(b,"i"),$.each(a,function(a,b){e.test(b)&&d.push({value:b})}),c(d)}},universityMap={"Columbia University":"columbia","New York University":"nyu","Stony Brook University":"stony","City University of New York":"cuny"},schoolInput;schoolInput={formSubmit:function(){$("#query-form").submit(function(a){var b=$("#search-str").val(),c=universityMap[b];return c?(a.preventDefault(),void(window.location="app/#/li/"+c)):!1})},init:function(a){$("#search-str").typeahead("destroy");var b=$("#search-str").typeahead({hint:!0,highlight:!0,minLength:1},{name:"schools",displayKey:"value",source:substringMatcher(Object.keys(universityMap)),templates:{empty:['<div class="tt-empty-message text-muted">','<i class="fa fa-frown-o"></i>',a,"</div>"].join("\n")}});return b},typeAhead:function(){var a=$("#search-str");a.on("typeahead:selected",function(){var a=$("#search-str").val(),b=universityMap[a];return b?void(window.location="app/#/li/"+b):!1}).on("typeahead:cursorchanged",function(){console.log($("#search-str").val()),console.log("autocomplete");var a=$("#search-btn");a.removeClass("disabled")}).on("typeahead:closed",function(){var a=$("#search-str").val(),b=$("#search-btn"),c=universityMap[a];c?(console.log("valid"),b.removeClass("disabled")):(console.log("invalid"),b.addClass("disabled"))}),a.keyup(function(){var a=$("#search-str").val(),b=$("#search-btn"),c=universityMap[a];c?(console.log("valid"),b.removeClass("disabled")):(console.log("invalid"),b.addClass("disabled"))})}};var userAuth={registerButtonClicked:function(){$("#register").click(function(){$("#register-modal").modal("show")})},loginButtonClicked:function(){$("#login").click(function(){$("#login-modal").modal("show")})},registerFormSubmit:function(){$("#register-form").submit(function(a){var b=$("#emailaddress").val(),c=$("#password").val();if(""==b&&""==c)return $(".form-group").addClass("has-error"),a.preventDefault(),void $("#msg").show("slow").html("The above fields cannot be blank!");if(""==b)return $("#emailaddress").addClass("has-error"),a.preventDefault(),void $("#msg").show("slow").html("Email address cannot be blank!");if(""==c)return $("#password").addClass("has-error"),a.preventDefault(),void $("#msg").show("slow").html("Password cannot be blank!");var d=b.split(".");if(1==d.length)return $("#emailaddress").addClass("has-error"),$("#msg").show("slow").html("Invalid email address!"),void a.preventDefault();if("edu"!=d[1])return $("#emailaddress").addClass("has-error"),$("#msg").show("slow").html("You must register with an .edu email address!"),void a.preventDefault();$("#register-form").serialize();$(".form-group").removeClass("has-error"),a.preventDefault(),$("#RegisterModal").modal("hide"),$("#InformationModal1").modal("show")})},loginFormSubmit:function(){$("#login-form").submit(function(a){var b=$("#emailaddress1").val(),c=$("#password1").val();return""==b&&""==c?($(".form-group").addClass("has-error"),a.preventDefault(),void $("#msg2").show("slow").html("The above fields cannot be blank!")):""==b?($("#emailaddress").addClass("has-error"),a.preventDefault(),void $("#msg2").show("slow").html("Email address cannot be blank!")):""==c?($("#password").addClass("has-error"),a.preventDefault(),void $("#msg2").show("slow").html("Password cannot be blank!")):void $.ajax({cache:!0,type:post,url:$("login-form").attr("action"),data:postData,dataType:json,success:function(){$(".oldLink").hide(),location.reload(),$(".newLink").find("a").attr("href","/profile?username="+username).html(username),$(".newLink").show()},error:function(){alert("aa")}})})},profileFormSubmit:function(){$("#personal-form-1").submit(function(a){{var b=$("#firstname").val(),c=$("#lastname").val();$("university").val()}return""==b&&""==c?($(".form-group").addClass("has-error"),a.preventDefault(),void $("#msg3").show("slow").html("The above fields cannot be blank!")):""==b?($("#firstname").addClass("has-error"),a.preventDefault(),void $("#msg3").show("slow").html("First name cannot be blank!")):""==c?($("#lastname").addClass("has-error"),a.preventDefault(),void $("#msg3").show("slow").html("Last name cannot be blank!")):void $.ajax({cache:!0,type:post,url:$("information-form-1").attr("action"),data:postData,dataType:json,success:function(){location.reload()},error:function(){alert("aa")}})})}};